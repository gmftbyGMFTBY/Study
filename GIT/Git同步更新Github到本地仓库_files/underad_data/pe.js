(function(k,d){var a="AppMain";if(k.define){return}function b(i){return Object.prototype.toString.call(i)==="[object Function]"}var m={};var g=document.getElementsByTagName("script");for(var h=0,f=g.length;h<f&&!a;h++){a=g[h].getAttribute("data-main")}if(!a){throw new Error("No data-main attribute in script tag.")}function c(i){if(!m[i]){throw new Error("Module "+i+" is not defined.")}var l=m[i];if(l.inited===false){e(i)}return l.ret}function e(n){var i={};var o=m[n];if(b(m[n].factory)){var l=m[n].factory.apply(d,[c,i,d]);o.ret=l===d?i:l}else{o.ret=m[n].factory}o.inited=true}function j(l,n,i){if(m[l]){throw new Error("Module "+l+" has been defined already.")}if(b(n)){i=n}m[l]={factory:i,inited:false};if(l===a){e(l)}}k.define=j;k.require=c})(window);define("pe/Config",function(c,b){var a={form:{FormName:"UploadContentForm",IfameName:"UploadContentIframe",UploadUrl:"http://dsp.brand.sogou.com/log_print"},doc:{url:"",title:"",mypos:"",metakeywords:"",metadescription:"",lastmodified:"",maincontent:"",charset:""}};return a});define("pe/Util",function(b,a){var d=document;if(typeof Function.prototype.inherit!="function"){Function.prototype.inherit=function(f){if(typeof f=="function"){this.prototype=new f;this.prototype.parent=f();this.prototype.constructor=this}}}var e={isFunction:function(f){return Object.prototype.toString.call(f)==="[object Function]"},findPos:function(f){var g={x:0,y:0};if(!!document.documentElement.getBoundingClientRect()){g.x=f.getBoundingClientRect().left+this.scroll().left;g.y=f.getBoundingClientRect().top+this.scroll().top}else{while(f){g.x+=f.offsetLeft;g.y+=f.offsetTop;f=f.offsetParent}}return g},indexOf:function c(g,h){if(g.indexOf){return g.indexOf(h)}else{var f=-1;this.each(g,function(i){if(this[i]===h){f=i;return false}});return f}},each:function(g,k,j){if(g===undefined||g===null){return}if(g.length===undefined||this.isFunction(g)){for(var f in g){if(g.hasOwnProperty(f)){if(k.call(j||g[f],f,g[f])===false){break}}}}else{for(var h=0;h<g.length;h++){if(k.call(j||g,h,g[h])===false){break}}}return g},css:function(){var f=function(j,g){var k="";if(g=="float"){document.defaultView?g="float":g="styleFloat"}if(j.style[g]){k=j.style[g]}else{if(j.currentStyle){k=j.currentStyle[g]}else{if(document.defaultView&&document.defaultView.getComputedStyle){g=g.replace(/([A-Z])/g,"-$1").toLowerCase();var h=document.defaultView.getComputedStyle(j,"");k=h&&h.getPropertyValue(g)}else{k=null}}}if((k=="auto"||k.indexOf("%")!==-1)&&("width"===g.toLowerCase()||"height"===g.toLowerCase())&&j.style.display!="none"&&k.indexOf("%")!==-1){k=j["offset"+g.charAt(0).toUpperCase()+g.substring(1).toLowerCase()]+"px"}if(g=="opacity"){try{k=j.filters["DXImageTransform.Microsoft.Alpha"].opacity;k=k/100}catch(l){try{k=j.filters("alpha").opacity}catch(i){}}}return k};return function(h,g){if(typeof g==="string"){return f(h,g)}else{this.each(g,function(i,j){h.style[i]=j})}}}(),scroll:function(){return{left:document.documentElement.scrollLeft+document.body.scrollLeft,top:document.documentElement.scrollTop+document.body.scrollTop}},browser:function(){return{isIE:navigator.appVersion.indexOf("MSIE",0)!=-1,isSafari:navigator.appVersion.indexOf("WebKit",0)!=-1,isFirefox:navigator.userAgent.indexOf("Firefox",0)!=-1,isIpad:navigator.userAgent.indexOf("WebKit")>0&&navigator.userAgent.indexOf("iPad")>0,isIphone:navigator.userAgent.indexOf("WebKit")>0&&navigator.userAgent.indexOf("iPhone")>0,isChrome:navigator.userAgent.indexOf("WebKit")>0&&navigator.userAgent.indexOf("Chrome")>0}}(),trim:function(f){if(typeof f!="string"){return f}else{return f.replace(/^\s+/,"").replace(/\s+$/,"")}},extend:function(i,g,h){if(typeof g!="object"){return false}for(var f in g){if(typeof i[f]!="undefined"){if(!h){i[f]=g[f]}else{i[f]=[i[f],g[f]]}}else{i[f]=g[f]}}},el:function(f){return d.getElementById(f)},mkel:function(f,g){try{var i=d.createElement(f);if(g){g.appendChild(i)}return i}catch(h){return false}},addEvent:function(h,f,g){if(!h.nodeType||h.nodeType!=1){return false}if(this.browser.isIE){h.attachEvent("on"+f,g)}else{h.addEventListener(f,g,false)}},deleteEvent:function(h,f,g){if(!h.nodeType||h.nodeType!=1){return false}if(this.browser.isIE){h.detachEvent("on"+f,g)}else{h.removeEventListener(f,g,false)}},wrapperEvent:function(g){var f={target:this.browser.isIE?g.srcElement:g.target,offsetX:this.browser.isIE?g.offsetX:g.layerX,offsetY:this.browser.isIE?g.offsetY:g.layerY,x:this.browser.isIE?g.x:g.pageX,y:this.browser.isIE?g.y:g.pageY};return f},enableDrag:function(f){var g=window;if(typeof f=="string"){f=this.el(f)}if(f.nodeType&&f.nodeType==1&&f.tagName.toLowercase()=="div"){f.style.position="absolute";this.addEvent(f,"mousedown",function(i){if(typeof g.YNoteDragObject=="undefined"||g.YNoteDragObject==null){var h=this.wrapperEvent(i);g.YNoteDragObject={element:h.target,startX:h.offsetX,startY:h.offsetY}}else{return false}});if(typeof g.YNoteDragObject=="undefined"){this.addEvent(g.document,"mouseup",function(h){if(g.YNoteDragObject!=null){g.YNoteDragObject=null}});this.addEvent(g.document,"mousemove",function(i){if(typeof g.YNoteDragObject=="undefined"||g.YNoteDragObject==null){return}var h=this.wrapperEvent(i);g.YNoteDragObject.element.style.left=h.x-g.YNoteDragObject.startX+"px";g.YNoteDragObject.element.style.top=h.y-g.YNoteDragObject.startY+"px"})}}},getCharSet:function(){if(this.browser.isIE){return document.charset.toLowerCase()}else{return document.characterSet.toLowerCase()}},HTMLEncode:function(n){var h="";var g=n.length;var l=navigator.userAgent.toLowerCase();var m=/msie/.test(l)?parseFloat(l.match(/msie ([\d.]+)/)[1]):false;if(m>=7){for(var k=0;k<g;k++){h+=n.charCodeAt(k)+" "}}else{for(var k=0;k<n.length;k++){var j=n.charCodeAt(k);var f=n[k];if(j>127){h+="&#"+j+";"}else{if(f==">"){h+="&gt;"}else{if(f=="<"){h+="&lt;"}else{if(f=="&"){h+="&amp;"}else{h+=n.charAt(k)}}}}}}return h},unicodeEncode:function(h){var f="";if(typeof h=="string"){for(var g=0;g<h.length;g++){var j=h.charCodeAt(g);if(j>127){f+="&#"+j+";"}else{f+=h.charAt(g)}}}return f},getTopWindowInSameDomain:function(h){var g=h;while(g.parent!=g.self){try{var i=g.parent.document.title;g=g.parent}catch(f){break}}return g},getInnerText:function(g){var f=g.innerText||g.textContent||"";f=this.trim(f);return f},getHostname:function(){var f=document.location.href.match(/^.*?:\/\/(www\.)?(.*?)(\/|$)/);if(f){return f[2]}return null}};return e});define("pe/Page",function(b,a){var e=b("pe/Util");var d=b("pe/Article");var c=function(g,f){this.win=g;this.contentDocument=f};c.prototype={IGNORE_TAGS:["HTML","HEAD","META","TITLE","SCRIPT","STYLE","LINK","IMG","FORM","INPUT","BODY","BUTTON","TEXTAREA","SELECT","OPTION","LABEL","IFRAME","A","OBJECT","PARAM","EMBED","NOSCRIPT","EM","B","STRONG","I","INS","BR","HR","PRE","H1","H2","H3","H4","H5","CITE"],getMainArticle:function(){var k=null,h="";if(!!location){h=location.hostname}if(/\b(google|facebook|twitter)\b/i.test(h)){return null}var g=this.getAllArticle();if(!(g&&g.length)){return null}g.sort(function(l,i){return i.weight-l.weight});var f=null;for(var j=0;j<2;j++){k=g[0];g.splice(0,1);if(k&&k.weight<200){k=null}if(k){break}}if(!k){return null}return k},getMetaKeywords:function(){var g="";var h=this.contentDocument.getElementsByTagName("meta");for(var f=0;f<h.length;f++){if(h[f].name.toLowerCase()=="keywords"){g=h[f].content;break}}return g},getMetaDescription:function(){var g="";var h=this.contentDocument.getElementsByTagName("meta");for(var f=0;f<h.length;f++){if(h[f].name.toLowerCase()=="description"){g=h[f].content;break}}return g},getTitle:function(){return this.contentDocument.title},getUrl:function(){var h=this.win;var f="";try{f=this.contentDocument.location;if(h.parent!=h.self){f=this.contentDocument.referrer||this.contentDocument.location}}catch(g){f=""}return f},getLastModified:function(){return this.contentDocument.lastModified},getCharset:function(){return this.contentDocument.charset||this.contentDocument.characterSet||""},getAllArticle:function(){var h=this.contentDocument.getElementsByTagName("*"),g=[];for(var f=0,j=h.length;f<j;f++){var i=h[f];if(this._checkTagName(i)&&this._checkSize(i)&&this._checkVisibility(i)){g[g.length]=new d(i)}}return g},_checkTagName:function(f){return e.indexOf(this.IGNORE_TAGS,f.tagName)==-1},_checkVisibility:function(f){return !(e.css(f,"visibility")=="hidden"||e.css(f,"display")=="none"||parseInt(e.css(f,"height"))<=0||parseInt(e.css(f,"width"))<=0)},_checkSize:function(f){return f.offsetWidth>300&&f.offsetHeight>150}};return c});define("pe/Article",function(b,a){var d=b("pe/Util");var c=function(e){this.elem=e;this.offset=d.findPos(e);this._texts=this._getAllTexts(e,6);this.weight=this.calcWeight()};c.prototype={IGNORE_TAGS:["OPTION","SCRIPT","STYLE","UL","LI","IFRAME"],TITLE_TAGS:["H1","H2","H3","H4","H5","H6"],MINOR_REGEXP:/comment|combx|disqus|foot|header|menu|rss|shoutbox|sidebar|sponsor/i,MAJOR_REGEXP:/article|entry|post|body|column|main|content/i,TINY_REGEXP:/comment/i,BLANK_REGEXP:/\S/i,debugWeight:function(){this.elem.setAttribute("debug-weight",this.weight);this.elem.setAttribute("debug-offset-x",this.offset.x);this.elem.setAttribute("debug-offset-y",this.offset.y);this.elem.setAttribute("debug-weight-struct",this.calcStructWeight());this.elem.setAttribute("debug-weight-content",this.calcContentWeight())},_getAllTexts:function(h,f){var e=[];if(f>0){var j=h.firstChild;while(j){if(j.nodeType==3&&this._checkLength(j)){var g=j.parentNode||{},i=g.parentNode||{};if(!(this._checkMinorContent(g)||this._checkMinorContent(i))&&d.trim(j.nodeValue)){e.push(j)}}else{if(j.nodeType==1&&this._checkTagName(j)){e=e.concat(this._getAllTexts(j,f-1))}}j=j.nextSibling}}return e},calcStructWeight:function(){var e=0;for(var j=0,f=this._texts.length;j<f;j++){var k=this._texts[j],h=d.trim(k.nodeValue).length,i=1;if(h<20){continue}for(var g=k.parentNode;g&&g!=this.elem;g=g.parentNode){i-=0.1}e+=Math.pow(i*h,1.25)}return e},calcContentWeight:function(){var e=1;for(var f=this.elem;f;f=f.parentNode){if(f.id){if(this.MAJOR_REGEXP.test(f.id)){e+=0.4}if(this.MINOR_REGEXP.test(f.id)){e-=0.8}}if(f.className){if(this.MAJOR_REGEXP.test(f.className)){e+=0.4}if(this.MINOR_REGEXP.test(f.className)){e-=0.8}}}return e},calcWeight:function(){return this.calcStructWeight()*this.calcContentWeight()},_checkTagName:function(e){return d.indexOf(this.IGNORE_TAGS,e.tagName)==-1},_checkTitle:function(){var o=this.elem.getElementsByTagName("*");var k=[];for(var g=0;o[g];g++){if(d.indexOf(this.TITLE_TAGS,o[g].tagName)>-1){k.push(o[g])}}if(k.length>2){var n=this.elem.offsetHeight;for(var l=0,e=d.findPos(this.elem),m=n*0.05,f=0;k[f];f++){var h=d.findPos(k[f]);h.y-e.y>m&&h.y+k[f].offsetHeight-(e.y+n)&&l++}if(n/l<300){return true}}return false},_checkLength:function(e){return Boolean(this.BLANK_REGEXP.test(e.nodeValue))},_checkMinorContent:function(e){return Boolean(this.TINY_REGEXP.test(e.id+" "+e.className))},_checkVisibility:function(e){return !(d.css(e,"visibility")=="hidden"||d.css(e,"display")=="none"||parseInt(d.css(e,"height"))<=0||parseInt(d.css(e,"width"))<=0)}};return c});define("pe/Bread",function(c,b){var e=c("pe/Util");var a=c("pe/BreadCrumb");var d=function(g,f){this.win=g;this.contentDocument=f};d.prototype={IGNORE_TAGS:["HTML","HEAD","META","TITLE","SCRIPT","STYLE","LINK","IMG","FORM","INPUT","BODY","BUTTON","TEXTAREA","SELECT","OPTION","LABEL","IFRAME","UL","OL","LI","DD","DL","DT","A","OBJECT","PARAM","EMBED","NOSCRIPT","EM","B","STRONG","I","INS","BR","HR","PRE","H1","H2","H3","H4","H5","CITE"],getMainBreadCrumb:function(){var h=null;var g=this.getAllBreadCrumb();if(!(g&&g.length)){return null}g.sort(function(k,i){return i.weight-k.weight});var f=null;for(var j=0;j<2;j++){h=g[0];g.splice(0,1);if(h&&h.weight<500){h=null}if(h){break}}if(!h){return null}return h},getAllBreadCrumb:function(){var h=this.contentDocument.getElementsByTagName("*"),g=[];for(var f=0,j=h.length;f<j;f++){var i=h[f];if(this._checkTagName(i)&&this._checkSize(i)&&this._checkVisibility(i)){g[g.length]=new a(i)}}return g},_checkTagName:function(f){return e.indexOf(this.IGNORE_TAGS,f.tagName)==-1},_checkVisibility:function(f){return !(e.css(f,"visibility")=="hidden"||e.css(f,"display")=="none"||parseInt(e.css(f,"height"))<=0||parseInt(e.css(f,"width"))<=0)},_checkSize:function(f){return f.offsetHeight>20&&f.offsetHeight<60}};return d});define("pe/BreadCrumb",function(c,b){var d=c("pe/Util");var a=function(e){this.elem=e;this.offset=d.findPos(e);this.text=d.getInnerText(e);this.weight=this.calcWeight()};a.prototype={MINOR_REGEXP:/foot|header|menu|rss|navigat/i,MAJOR_REGEXP:/bread|crumb|current|path|position|mypos/i,BLANK_REGEXP:/\S/i,SPECIAL_CHAR_CODE:[62,187,8594,12299],debugWeight:function(){this.elem.setAttribute("crumb-weight",this.weight);this.elem.setAttribute("crumb-offset-x",this.offset.x);this.elem.setAttribute("crumb-offset-y",this.offset.y);this.elem.setAttribute("crumb-weight-struct",this.calcStructWeight());this.elem.setAttribute("crumb-weight-content",this.calcContentWeight());this.elem.setAttribute("crumb-weight-verify",this.calcVerifyWeight())},calcStructWeight:function(){var f=0;var h=this._trimSpecialChar(this.text);var g=this._countSpecialChar(h);f+=500*g;var e=h.length;f+=30-e;if(this._checkPositionX()){f+=20}else{f-=20}if(this._checkWidth()){f+=20}else{f-=20}return f},calcContentWeight:function(){var e=1;for(var f=this.elem;f;f=f.parentNode){if(f.id){if(this.MAJOR_REGEXP.test(f.id)){e+=0.4}if(this.MINOR_REGEXP.test(f.id)){e-=0.2}}if(f.className){if(this.MAJOR_REGEXP.test(f.className)){e+=0.4}if(this.MINOR_REGEXP.test(f.className)){e-=0.2}}}return e},calcVerifyWeight:function(){var e=1;if(!this._checkBlank(this.text)){e=0}if(!this._checkLinkPattern()){e=0}if(!this._checkPositionY()){e=0}return e},calcWeight:function(){return this.calcStructWeight()*this.calcContentWeight()*this.calcVerifyWeight()},_checkBlank:function(e){return Boolean(this.BLANK_REGEXP.test(e))},_hasSpecialChar:function(k){var e=false;if(typeof k=="string"){for(var g=0;g<k.length;g++){var l=k.charCodeAt(g);for(var f in this.SPECIAL_CHAR_CODE){var h=this.SPECIAL_CHAR_CODE[f];if(h==l){e=true;break}}if(e){break}}}return e},_countSpecialChar:function(h){var f=0;var g=h.length;for(var e=0;e<g;e++){var j=h.charAt(e);if(this._hasSpecialChar(j)){f++}}return f},_trimSpecialChar:function(e){if(typeof e!="string"){return e}else{return e.replace(/^>+/,"").replace(/>+$/,"")}},_checkLinkPattern:function(){var k=this.elem;var g=k.childNodes;var f=g.length;var h=0;for(var j=0;j<f;j++){var m=g[j];if(m.nodeType==1&&m.tagName=="A"){var l=d.getInnerText(m);if(l.length>0){h++}}else{if(m.nodeType==3){var e=m.nodeValue;e=d.trim(e);if(this._hasSpecialChar(e)){if(h>0){h--}}}else{if(m.nodeType==1&&m.tagName!="A"){var e=d.getInnerText(m);if(this._hasSpecialChar(e)){if(h>0){h--}}}}}if(h>1){return false}}return true},_checkPositionY:function(){var e=this.offset.y+this.elem.offsetHeight;var f=window.screen.height*2/3;return e<f},_checkPositionX:function(){var e=this.offset.x+this.elem.offsetWidth;var f=window.screen.width*4/5;return e<f},_checkWidth:function(){var e=this.elem.offsetWidth;var f=window.screen.width*1/2;return e<f}};return a});define("pe/Uploader",function(c,b){var e=c("pe/Util");var a=c("pe/Config");var d=function(g,f){this.win=g;this.contentDocument=f;this.init()};e.extend(d.prototype,{init:function(){var h=this.contentDocument.body;var g=e.mkel("div",h);this.ifameContainer=g;e.extend(g.style,{display:"none"});var f="";f+='<iframe width="1" height="1" src="javascript:document.write(\'\');"';f+='id="'+a.form.IfameName+'" name="'+a.form.IfameName+'">';f+="</iframe>";g.innerHTML=f},getNavigatorSign:function(){var f=navigator.userAgent.toLowerCase();var g=/msie/.test(f)?parseFloat(f.match(/msie ([\d.]+)/)[1]):false;if(parseInt(g)>=7){return"true"}else{return"false"}},buildForm:function(){var j=this.contentDocument.body;var g=e.mkel("div",j);this.formContainer=g;e.extend(g.style,{display:"none"});var i=e.mkel("form",g);this.uploadForm=i;e.extend(i,{id:a.form.FormName,name:a.form.FormName,action:a.form.UploadUrl,target:a.form.IfameName,enctype:"application/x-www-form-urlencoded",encoding:"application/x-www-form-urlencoded",method:"POST"});var f=a.doc.maincontent||"";f=f.replace(/[\r\n]/g,"");var h="";h+='<input type="text" name="url" value="'+a.doc.url+'"/>';h+='<textarea name="title">'+a.doc.title+"</textarea>";h+='<textarea name="mypos">'+a.doc.mypos+"</textarea>";h+='<textarea name="metakeywords">'+a.doc.metakeywords+"</textarea>";h+='<textarea name="metadescription">'+a.doc.metadescription+"</textarea>";h+='<input type="text" name="lastmodified" value="'+a.doc.lastmodified+'"/>';h+='<input type="text" name="charset" value="'+a.doc.charset+'"/>';h+='<textarea name="maincontent">'+f+"</textarea>";i.innerHTML=h},removeForm:function(){this.formContainer.innerHTML="";this.ifameContainer.innerHTML=""},upload:function(){this.buildForm();this.uploadForm.submit()}});return d});define("AppMain",function(k,E){var u=k("pe/Util");var j=k("pe/Config");var w=k("pe/Uploader");var o=k("pe/Page");var D=k("pe/Article");var n=k("pe/Bread");var y=k("pe/BreadCrumb");var v=u.getTopWindowInSameDomain(window)||window;var g=v.document;var x=new o(v,g);var q=new n(v,g);var p="SOGOU_STAR_URL_DATA";var h=window[p];if(!h){return}var m=h.specialcase;var c=h.selector;var z=h.contenttype;var B=h.mypos_sc;var r=h.mypos_s;var t=h.mypos_ct;var C=null;var f=null;if((m>0||B>0)&&!g.querySelector){return}if(m==1){var A=g.querySelector(c);if(A){C=new D(A)}}else{if(m>1){var d=g.querySelectorAll(c);if(d&&d.length>0){f=new Array();for(var s=0;s<d.length;s++){var A=d[s];f.push(new D(A))}}}}if(!C&&(!f||f.length<1)){C=x.getMainArticle()}function b(H,G){var I="";if(G=="html"){I=H.elem.innerHTML}else{var F=H._texts;for(var K=0,J=F.length;K<J;K++){var L=F[K];I+=L.nodeValue}}return I}var i="";if(C){i=b(C,z)}else{if(f){for(var s in f){var C=f[s];i+=b(C,z)}}else{i=""}}i=i.replace(/[\r\n]/g,"");var e=null;if(B==1){var A=g.querySelector(r);if(A){e=new y(A)}}if(!e){e=q.getMainBreadCrumb()}var l="";if(e){if(t=="html"){l=e.elem.innerHTML}else{l=e.text}l=l.replace(/[\r\n]/g,"")}j.doc.url=x.getUrl();j.doc.title=x.getTitle();j.doc.mypos=l;j.doc.metakeywords=x.getMetaKeywords();j.doc.metadescription=x.getMetaDescription();j.doc.lastmodified=x.getLastModified();j.doc.charset=x.getCharset();j.doc.maincontent=i;var a=new w(v,g);a.upload()});